#! /usr/bin/env bash

#---- Usage -----
# tmuxinit session_name


SESSION_NAME="$1" # change session name

# Check if session already exists
tmux has-session -t "$SESSION_NAME" 2>/dev/null

if [ $? != 0 ]; then
    # Window 0: nvim
    tmux new-session -d -s "$SESSION_NAME" -n nvim
    # activate venv if there is a .env folder
    if [ -d .env ]; then
        tmux send-keys -t "$SESSION_NAME:0" "source .env/bin/activate" C-m
    fi
    tmux send-keys -t "$SESSION_NAME:0" "nvim ." C-m

    # Window 1: term
    tmux new-window -t "$SESSION_NAME:1" -n term
    if [ -d .env ]; then
        tmux send-keys -t "$SESSION_NAME:0" "source .env/bin/activate" C-m
    fi

    # Window 2: git
    tmux new-window -t "$SESSION_NAME:2" -n git
    if [ -d .env ]; then
        tmux send-keys -t "$SESSION_NAME:0" "source .env/bin/activate" C-m
    fi
    tmux send-keys -t "$SESSION_NAME:2" "lazygit" C-m

    # Window 3: file manager
    tmux new-window -t "$SESSION_NAME:3" -n files
    if [ -d .env ]; then
        tmux send-keys -t "$SESSION_NAME:0" "source .env/bin/activate" C-m
    fi
    # open yazi
    tmux send-keys -t "$SESSION_NAME:3" "y" C-m
fi

# Always open in first window
tmux select-window -t $SESSION_NAME:0
# Attach to session
tmux attach -t $SESSION_NAME

